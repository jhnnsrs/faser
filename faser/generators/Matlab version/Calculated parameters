function [Cp]=Calculated_parameters(Sp)

% Convert angle in rad
Cp.gamma=Sp.gamma*pi/180; % tilt angle (in rad)
Cp.psi=Sp.psi*pi/180; % direction polar
Cp.eps=Sp.eps*pi/180; % ellipticity

Cp.k0=2*pi./Sp.lambda; % wavenumber (in nm-1)
Cp.alpha=asin(Sp.NA/Sp.n1); % maximum focusing angle of the objective (in rad)
Cp.r0=Sp.WD*tan(Cp.alpha); % pupil radius (in m)
Cp.alpha_int=Cp.alpha+abs(Cp.gamma); % Integration range (in rad)
Cp.r0_int=Sp.WD*sin(Cp.alpha_int);   % integration radius on pupil (in m)

% Impact of the cranial window
Cp.alpha_eff=min(atan(Sp.r_wind/Sp.e_wind),Cp.alpha);  % effective focalization angle in presence of the cranial window
Cp.NA_eff=min(Sp.n1*sin(Cp.alpha_eff),Sp.NA);  % Effective NA in presence of the cranial window
Cp.r0_eff=Sp.WD*sin(Cp.alpha_eff); % Effective pupil radius 'in m)

% Corrected focus position
Cp.alpha2_eff=asin((Sp.n1/Sp.n2)*sin(Cp.alpha_eff));
Cp.alpha3_eff=asin((Sp.n2/Sp.n3)*sin(Cp.alpha2_eff));
% Cp.Dfoc=Sp.depth*(tan(Cp.alpha_eff)/tan(Cp.alpha3_eff)-1)+Sp.thick*(tan(Cp.alpha_eff)-tan(Cp.alpha2_eff))/tan(Cp.alpha3_eff);
Cp.Dfoc=0.0*Sp.depth+0.242*Sp.thick;
% Cp.Dfoc=-0.97e-6;
% Cp.Dfoc=0e-6;

% Step and range of integral
Cp.deltatheta=Cp.alpha_int/Sp.Ntheta;
Cp.deltaphi=2*pi/Sp.Nphi;

Cp.cg=cos(Cp.gamma);
Cp.sg=sin(Cp.gamma);